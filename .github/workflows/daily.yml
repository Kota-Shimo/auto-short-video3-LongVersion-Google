name: Auto-Vocab-Daily

on:
  schedule:
    - cron: '0 19 * * *'   # JST04:00 â†’ ãƒ‘ã‚¿ãƒ¼ãƒ³â‘ ï¼ˆä¼šè©±ãªã—ï¼‰
    - cron: '0 9  * * *'   # JST18:00 â†’ ãƒ‘ã‚¿ãƒ¼ãƒ³â‘¡ï¼ˆæœ€å¾Œã«ä¼šè©±1ãƒ–ãƒ­ãƒƒã‚¯ï¼‰
    - cron: '0 15 * * *'   # JST00:00 â†’ ãƒ‘ã‚¿ãƒ¼ãƒ³â‘¢ï¼ˆæ¯ãƒ©ã‚¦ãƒ³ãƒ‰ä¼šè©±ï¼‰
  workflow_dispatch:
    inputs:
      mode:
        description: "å‹•ç”»æ§‹æˆãƒ¢ãƒ¼ãƒ‰"
        required: true
        default: "no-convo"
        type: choice
        options:
          - no-convo
          - final-convo
          - every-convo

concurrency:
  group: auto-vocab-${{ github.ref }}
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 540

    steps:
      - name: â¬‡ï¸ Checkout repo
        uses: actions/checkout@v4

      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
          cache: 'pip'

      - name: ğŸ“¦ Install requirements
        run: |
          sudo apt-get update -y
          sudo apt-get install -y ffmpeg
          python -m pip install --upgrade pip
          python -m pip install -r requirements.txt

      - name: ğŸ”‘ Restore YouTube tokens
        env:
          YT_ACC1: ${{ secrets.YT_TOKEN_ACC1 }}
          YT_ACC2: ${{ secrets.YT_TOKEN_ACC2 }}
          YT_ACC3: ${{ secrets.YT_TOKEN_ACC3 }}
          YT_ACC4: ${{ secrets.YT_TOKEN_ACC4 }}
          YT_ACC5: ${{ secrets.YT_TOKEN_ACC5 }}
          YT_ACC6: ${{ secrets.YT_TOKEN_ACC6 }}
          YT_ACC7: ${{ secrets.YT_TOKEN_ACC7 }}
          YT_ACC8: ${{ secrets.YT_TOKEN_ACC8 }}
          YT_ACC9: ${{ secrets.YT_TOKEN_ACC9 }}
        run: |
          mkdir -p tokens
          for i in {1..9}; do
            VAL=$(printenv YT_ACC${i})
            if [ -n "$VAL" ]; then
              echo "Restoring acc${i}..."
              echo "$VAL" | base64 -d > "tokens/token_acc${i}.pkl"
            fi
          done

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ãƒ‘ã‚¿ãƒ¼ãƒ³â‘  å˜èªï¼‹ä¾‹æ–‡ã®ã¿ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ¬ Pattern â‘  Vocab + Example only
        if: github.event.schedule == '0 19 * * *'
        env:
          OPENAI_API_KEY:      ${{ secrets.OPENAI_API_KEY }}
          UNSPLASH_ACCESS_KEY: ${{ secrets.UNSPLASH_ACCESS_KEY }}
          VOCAB_WORDS:         30
          WORD_REPEAT:         1
          NO_CONVO:            "1"     # â† ä¼šè©±ãªã—
        run: |
          python main.py AUTO --privacy public --chunk 999

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ãƒ‘ã‚¿ãƒ¼ãƒ³â‘¡ æœ€å¾Œã«ä¼šè©± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ¬ Pattern â‘¡ Vocab + Example + Final Convo
        if: github.event.schedule == '0 9 * * *'
        env:
          OPENAI_API_KEY:      ${{ secrets.OPENAI_API_KEY }}
          UNSPLASH_ACCESS_KEY: ${{ secrets.UNSPLASH_ACCESS_KEY }}
          VOCAB_WORDS:         20
          WORD_REPEAT:         1
          NO_CONVO:            "0"
          CONVO_LINES:         8
        run: |
          python main.py AUTO --privacy public --chunk 999

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ãƒ‘ã‚¿ãƒ¼ãƒ³â‘¢ å„ãƒ©ã‚¦ãƒ³ãƒ‰ã”ã¨ã«ä¼šè©± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ¬ Pattern â‘¢ Every-round Convo
        if: github.event.schedule == '0 15 * * *'
        env:
          OPENAI_API_KEY:      ${{ secrets.OPENAI_API_KEY }}
          UNSPLASH_ACCESS_KEY: ${{ secrets.UNSPLASH_ACCESS_KEY }}
          VOCAB_WORDS:         10
          VOCAB_ROUNDS:        3
          WORD_REPEAT:         1
          NO_CONVO:            "0"
          CONVO_LINES:         6
        run: |
          python main.py AUTO --privacy public --chunk 999